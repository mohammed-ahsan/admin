import{r as c,S as te,f as re,j as e,e as m,L as Y}from"./index-kaEKLpWB.js";import{u as $,S as ne,I as le}from"./Layout-XJLSbV9V.js";import{s as Q,D as q,d as ie,r as X}from"./draftjs-to-html-_4L3Ymn1.js";import{C as oe,S as de}from"./BulkActionDrawer-BTJIHzVi.js";import{T as Z,D as ce,u as me,M as pe}from"./DrawerButton-fnQ8qkSd.js";import{D as xe,E as ue}from"./EditDeleteButton--eCAtp8b.js";import{T as he}from"./ParentCategory-GAgzQS_4.js";import{n as O,a as k}from"./toast-33DDocbW.js";import{u as ge,E as y}from"./index.esm-UHEZOc8y.js";import{I as be}from"./InputArea-6bVCC4zo.js";import{L}from"./LabelArea-0V6LeSph.js";import{S as G}from"./SwitchToggle-Cy2HBZ9n.js";import{U as fe}from"./Uploader-cS0uZHKZ.js";import{C as B}from"./ProductServices-Rz27ds4X.js";const J=n=>{const o=Q(n);return q.EditorState.createWithContent(o)},je=(n,o)=>{const{isDrawerOpen:r,closeDrawer:f,setIsUpdate:b,lang:C}=c.useContext(te),[N,v]=c.useState({}),[S,w]=c.useState(""),[D,p]=c.useState(""),[E,s]=c.useState([]),[l,j]=c.useState(C),[d,I]=c.useState(!0),[U,F]=c.useState(!1),[H,T]=c.useState(""),[M,_]=c.useState(!1),[P,A]=c.useState(J("")),{showingTranslateValue:R}=$(),{register:t,handleSubmit:x,setValue:a,clearErrors:u,reset:V,formState:{errors:ee}}=ge(),se=async({name:h,description:i})=>{var z,K;try{_(!0);const g={name:{[l]:h},slug:h.toLowerCase().replace(/[^A-Z0-9]+/gi,"-"),description:{[l]:ie(q.convertToRaw(P.getCurrentContent()))||""},parentId:S||void 0,parentName:H||"Home",icon:D,status:d?"show":"hide",catalog:U?"show":"hide",lang:l};if(console.log("category submit",g),n){const W=await B.updateCategory(n,g);b(!0),_(!1),k(W.message),f(),V()}else{const W=await B.addCategory(g);b(!0),_(!1),k(W.message),f()}}catch(g){_(!1),O(g?(K=(z=g==null?void 0:g.response)==null?void 0:z.data)==null?void 0:K.message:g==null?void 0:g.message),f()}},ae=h=>{j(h),Object.keys(N).length>0&&(a("name",N.name[h||"en"]),a("description",N.description[h||"en"]))};return c.useEffect(()=>{var h;if(!r){v({}),a("name"),a("parentId"),a("parentName"),a("description"),a("icon"),p(""),I(!0),F(!1),u("name"),u("parentId"),u("parentName"),u("description"),T("Home"),j(C),a("language",l),o!==void 0&&((h=o[0])==null?void 0:h._id)!==void 0&&w(o[0]._id);return}n&&(async()=>{try{const i=await B.getCategoryById(n);console.log("res category",i),i&&(v(i),a("name",i.name[l||"en"]),a("description",i.description[l||"en"]),a("language",l),a("parentId",i.parentId),a("parentName",i.parentName),T(i.parentName),w(i.parentId),p(i.icon),I(i.status==="show"),F(i.catalog==="show"),A(J(R(i.description))))}catch(i){O(i?i.response.data.message:i.message)}})()},[n,a,r,l,u,o,C]),{register:t,handleSubmit:x,onSubmit:se,errors:ee,imageUrl:D,setImageUrl:p,children:E,setChildren:s,published:d,setPublished:I,checked:S,setChecked:w,isSubmitting:M,enabledForCatalog:U,setEnabledForCatalog:F,categoryDescription:P,setCategoryDescription:A,selectCategoryName:H,setSelectCategoryName:T,handleSelectLanguage:ae}},Se=({id:n,data:o})=>{const{t:r}=re(),{checked:f,register:b,onSubmit:C,handleSubmit:N,errors:v,imageUrl:S,setImageUrl:w,published:D,setPublished:p,setChecked:E,enabledForCatalog:s,setEnabledForCatalog:l,categoryDescription:j,setCategoryDescription:d,selectCategoryName:I,setSelectCategoryName:U,handleSelectLanguage:F,isSubmitting:H}=je(n,o),{showingTranslateValue:T}=$(),M=`
  .rc-tree-child-tree {
    display: hidden;
  }
  .node-motion {
    transition: all .3s;
    overflow-y: hidden;
  }
`,_={motionName:"node-motion",motionAppear:!1,onAppearStart:t=>({height:0}),onAppearActive:t=>({height:t.scrollHeight}),onLeaveStart:t=>({height:t.offsetHeight}),onLeaveActive:()=>({height:0})},P=t=>{let x=[];for(let a of t)x.push({title:T(a.name),key:a._id,children:a.children.length>0&&P(a.children)});return x},A=(t,x)=>{var a;return t._id===x?t:(a=t==null?void 0:t.children)==null?void 0:a.reduce((u,V)=>u??A(V,x),void 0)},R=async t=>{if(t!==void 0)if(n){const x=await B.getCategoryById(t);if(n===t)return O("This can't be select as a parent category!");if(n===x.parentId)return O("This can't be select as a parent category!");{if(t===void 0)return;E(t);const a=o[0],u=A(a,t);U(T(u==null?void 0:u.name))}}else{if(t===void 0)return;E(t);const x=o[0],a=A(x,t);U(T(a==null?void 0:a.name))}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full relative p-6 border-b border-gray-100 bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:n?e.jsx(Z,{register:b,handleSelectLanguage:F,title:r("UpdateCategory"),description:r("UpdateCategoryDescription")}):e.jsx(Z,{register:b,handleSelectLanguage:F,title:r("AddCategoryTitle"),description:r("AddCategoryDescription")})}),e.jsx(ne,{className:"w-full md:w-7/12 lg:w-8/12 xl:w-8/12 relative dark:bg-gray-700 dark:text-gray-200",children:e.jsxs("form",{onSubmit:N(C),children:[e.jsxs("div",{className:"p-6 flex-grow scrollbar-hide w-full max-h-full pb-40",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(L,{label:r("Name")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(be,{register:b,label:"Category title",name:"name",type:"text",placeholder:r("ParentCategoryPlaceholder")}),e.jsx(y,{errorName:v.name})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(L,{label:r("Description")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(X.Editor,{editorState:j,wrapperClassName:"demo-wrapper",editorClassName:"demo-editor",onEditorStateChange:d,editorStyle:{border:"1px solid #F1F1F1",padding:"0 15px"}}),e.jsx(y,{errorName:v.description})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(L,{label:r("ParentCategory")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4 relative",children:[e.jsx(m.Input,{readOnly:!0,...b("parent",{required:!1}),name:"parent",value:I||"Home",placeholder:r("ParentCategory"),type:"text"}),e.jsxs("div",{className:"draggable-demo capitalize",children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:M}}),e.jsx(he,{expandAction:"click",treeData:P(o),selectedKeys:[f],onSelect:t=>R(t[0]),motion:_,animation:"slide-up"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(L,{label:r("CategoryIcon")}),e.jsx("div",{className:"col-span-8 sm:col-span-4",children:e.jsx(fe,{imageUrl:S,setImageUrl:w,folder:"category"})})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(L,{label:r("Published")}),e.jsx("div",{className:"col-span-8 sm:col-span-4",children:e.jsx(G,{handleProcess:p,processOption:D})})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(L,{label:"Enable for Catalog"}),e.jsx("div",{className:"col-span-8 sm:col-span-4",children:e.jsx(G,{handleProcess:l,processOption:s})})]})]}),e.jsx(ce,{id:n,title:"Category",isSubmitting:H})]})})]})},Ce=n=>{const o=Q(n);return q.EditorState.createWithContent(o)},Be=({data:n,lang:o,isCheck:r,categories:f,setIsCheck:b,useParamId:C,showChild:N})=>{const{title:v,serviceId:S,handleModalOpen:w,handleUpdate:D}=me(),{showingTranslateValue:p}=$(),E=s=>{const{id:l,checked:j}=s.target;b([...r,l]),j||b(r.filter(d=>d!==l))};return e.jsxs(e.Fragment,{children:[(r==null?void 0:r.length)<1&&e.jsx(xe,{useParamId:C,id:S,title:v}),e.jsx(pe,{children:e.jsx(Se,{id:S,data:n,lang:o})}),e.jsx(m.TableBody,{children:f==null?void 0:f.map(s=>{var l,j;return e.jsxs(m.TableRow,{children:[e.jsx(m.TableCell,{children:e.jsx(oe,{type:"checkbox",name:"category",id:s._id,handleClick:E,isChecked:r==null?void 0:r.includes(s._id)})}),e.jsx(m.TableCell,{className:"font-semibold uppercase text-xs",children:(l=s==null?void 0:s._id)==null?void 0:l.substring(20,24)}),e.jsx(m.TableCell,{children:s!=null&&s.icon?e.jsx(m.Avatar,{className:"hidden mr-3 md:block bg-gray-50 p-1",src:s==null?void 0:s.icon,alt:s==null?void 0:s.parent}):e.jsx(m.Avatar,{src:"https://res.cloudinary.com/ahossain/image/upload/v1655097002/placeholder_kvepfp.png",alt:"product",className:"hidden p-1 mr-2 md:block bg-gray-50 shadow-none"})}),e.jsx(m.TableCell,{className:"font-medium text-sm ",children:(s==null?void 0:s.children.length)>0?e.jsxs(Y,{to:`/categories/${s==null?void 0:s._id}`,className:"text-blue-700",children:[p(s==null?void 0:s.name),e.jsx(e.Fragment,{children:N&&e.jsxs(e.Fragment,{children:[" ",e.jsx("div",{className:"pl-2 ",children:(j=s==null?void 0:s.children)==null?void 0:j.map(d=>e.jsx("div",{children:e.jsx(Y,{to:`/categories/${d==null?void 0:d._id}`,className:"text-blue-700",children:e.jsxs("div",{className:"flex text-xs items-center  text-blue-800",children:[e.jsx("span",{className:" text-xs text-gray-500 pr-1",children:e.jsx(le,{})}),e.jsx("span",{className:"text-gray-500",children:p(d.name)})]})})},d._id))})]})})]}):e.jsx("span",{children:p(s==null?void 0:s.name)})}),e.jsx(m.TableCell,{className:"text-sm",children:e.jsx(X.Editor,{editorState:Ce(p(s.description)),wrapperClassName:"demo-wrapper",editorClassName:"demo-editor",editorStyle:{border:"1px solid #F1F1F1",padding:"0 15px",width:"300px",height:"200px",overflow:"auto"},toolbarHidden:!0})}),e.jsx(m.TableCell,{className:"text-center",children:e.jsx(de,{id:s._id,category:!0,status:s.status})}),e.jsx(m.TableCell,{children:e.jsx(ue,{id:s==null?void 0:s._id,parent:s,isCheck:r,children:s==null?void 0:s.children,handleUpdate:D,handleModalOpen:w,title:p(s==null?void 0:s.name)})})]},s._id)})})]})};export{Se as C,Be as a};
